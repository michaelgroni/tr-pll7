#pragma once

#include "pico/stdlib.h"

#include <array>

class Si5351
{
public:
    static Si5351 *getInstance();
    void write(const uint32_t frequency);

private:
    uint32_t oldPllFrequency = 0;

    Si5351();
    Si5351(const Si5351 &);            // disable copy constructor
    Si5351 &operator=(const Si5351 &); // disable operator =

    uint32_t pllFrequency(uint32_t frequency);
    void writePLL(const uint8_t *values);

    const std::array<uint8_t, 219> registerMap = {
        16,                                             // first register to write
        0x4F,                                           //  16 CLK0
        0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,       //  17 -  23 other CLKs powered down
        0x00, 0x00,                                     //  24 -  25 all CLKs LOW when disabled
        0x02, 0x71, 0x00, 0x0C, 0x9C, 0x00, 0x01, 0x24, //  26 -  33 generated by ClockBuilder
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //  34 -  41 generated by ClockBuilder
        0x00, 0x01, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, //  42 -  49 MS0
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //  50 -  57 MS1
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //  58 -  65 MS2
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //  66 -  73 MS3
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //  74 -  81 MS4
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //  82 -  89 MS5
        0x00, 0x00, 0x00,                               //  90 -  92 MS7
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //  93 - 100 generated by ClockBuilder
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 101 - 108 generated by ClockBuilder
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 109 - 116 generated by ClockBuilder
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 117 - 124 generated by ClockBuilder
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // 125 - 132 generated by ClockBuilder
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x30,
        0x00,
        0xD2,
        0x60,
        0x60,
        0x00,
        0xC0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x0D,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
    };
};
